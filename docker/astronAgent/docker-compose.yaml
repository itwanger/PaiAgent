services:
  # ============================================================================
  # Infrastructure Services
  # ============================================================================

  # PostgreSQL Database
  postgres:
    image: postgres:14
    container_name: astron-agent-postgres
    environment:
      POSTGRES_DB: sparkdb_manager
      POSTGRES_USER: ${POSTGRES_USER:-spark}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-spark123}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./pgsql/:/docker-entrypoint-initdb.d/
    networks:
      - astron-agent-network
    restart: always
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER:-spark} -d sparkdb_manager"]
      interval: ${HEALTH_CHECK_INTERVAL:-30s}
      timeout: ${HEALTH_CHECK_TIMEOUT:-10s}
      retries: ${HEALTH_CHECK_RETRIES:-60}

  # MySQL Database
  mysql:
    image: mysql:8.4
    container_name: astron-agent-mysql
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-root123}
    volumes:
      - mysql_data:/var/lib/mysql
      - ./mysql/:/docker-entrypoint-initdb.d/
    networks:
      - astron-agent-network
    restart: always
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: ${HEALTH_CHECK_INTERVAL:-30s}
      timeout: ${HEALTH_CHECK_TIMEOUT:-10s}
      retries: ${HEALTH_CHECK_RETRIES:-60}

  # Redis Cache
  redis:
    image: redis:7
    container_name: astron-agent-redis
    volumes:
      - redis_data:/data
    networks:
      - astron-agent-network
    restart: always
    command: redis-server ${REDIS_PASSWORD:+--requirepass} ${REDIS_PASSWORD}
    healthcheck:
      test: ["CMD-SHELL", "redis-cli ${REDIS_PASSWORD:+-a \"$REDIS_PASSWORD\"} ping | grep PONG"]
      interval: ${HEALTH_CHECK_INTERVAL:-30s}
      timeout: ${HEALTH_CHECK_TIMEOUT:-10s}
      retries: ${HEALTH_CHECK_RETRIES:-60}
  # MinIO Object Storage
  minio:
    image: minio/minio:RELEASE.2025-07-23T15-54-02Z
    container_name: astron-agent-minio
    environment:
      MINIO_ROOT_USER: ${MINIO_ROOT_USER:-minioadmin}
      MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD:-minioadmin123}
      MINIO_SERVER_URL: ${OSS_REMOTE_ENDPOINT:-http://localhost:18998}
    ports:
      - "${EXPOSE_MINIO_PORT:-9000}:9000"
      - "${EXPOSE_MINIO_CONSOLE_PORT:-9001}:9001"
    volumes:
      - minio_data:/data
    networks:
      - astron-agent-network
    restart: always
    command: server /data --console-address ":9001"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: ${HEALTH_CHECK_INTERVAL:-30s}
      timeout: ${HEALTH_CHECK_TIMEOUT:-10s}
      retries: ${HEALTH_CHECK_RETRIES:-60}

  # ============================================================================
  # astron-agent Core Services
  # ============================================================================

  # Memory Database Service


  # Link Plugin Service
  core-link:
    image: core-link:local
    build:
      context: ../../
      dockerfile: core/plugin/link/Dockerfile
    container_name: astron-agent-core-link
    environment:
      SERVICE_PORT: "${CORE_LINK_PORT:-18888}"
      MYSQL_HOST: "${MYSQL_HOST:-mysql}"
      MYSQL_PORT: "${MYSQL_PORT:-3306}"
      MYSQL_USER: "${MYSQL_USER:-root}"
      MYSQL_PASSWORD: "${MYSQL_PASSWORD:-root123}"
      MYSQL_DB: "${LINK_MYSQL_DB:-spark-link}"
      REDIS_IS_CLUSTER: "${REDIS_IS_CLUSTER:-false}"
      REDIS_ADDR: "${REDIS_ADDR:-redis:6379}"
      REDIS_CLUSTER_ADDR: "${REDIS_CLUSTER_ADDR}"
      REDIS_PASSWORD: "${REDIS_PASSWORD}"
      OTLP_ENDPOINT: "${OTLP_ENDPOINT:-127.0.0.1:4317}"
      OTLP_ENABLE: "${OTLP_ENABLE:-0}"
      KAFKA_ENABLE: "${KAFKA_ENABLE:-0}"
      KAFKA_SERVERS: "${KAFKA_SERVERS:-kafka:29092}"
    depends_on:
      postgres:
        condition: service_healthy
      mysql:
        condition: service_healthy
      redis:
        condition: service_healthy
      minio:
        condition: service_healthy
    volumes:
      - ./config/link/config.env:/opt/core/plugin/link/config.env
      - ./config/link/logs/:/opt/core/plugin/link/logs/
    networks:
      - astron-agent-network
    restart: always

  # AI Tools Plugin Service
  core-aitools:
    image: core-aitools:local
    build:
      context: ../../
      dockerfile: core/plugin/aitools/Dockerfile
    container_name: astron-agent-core-aitools
    environment:
      SERVICE_PORT: "${CORE_AITOOLS_PORT:-18668}"
      OSS_TYPE: "${OSS_TYPE:-s3}"
      OSS_ENDPOINT: "${OSS_ENDPOINT:-http://minio:9000}"
      OSS_ACCESS_KEY_ID: "${OSS_ACCESS_KEY_ID:-minioadmin}"
      OSS_ACCESS_KEY_SECRET: "${OSS_ACCESS_KEY_SECRET:-minioadmin123}"
      OSS_BUCKET_NAME: "${OSS_BUCKET_NAME}"
      OSS_DOWNLOAD_HOST: "${OSS_REMOTE_ENDPOINT}"
      OSS_TTL: "${OSS_TTL:-157788000}"
      KAFKA_ENABLE: "${KAFKA_ENABLE:-0}"
      KAFKA_SERVERS: "${KAFKA_SERVERS:-kafka:29092}"
      AI_APP_ID: "${PLATFORM_APP_ID}"
      AI_API_KEY: "${PLATFORM_API_KEY}"
      AI_API_SECRET: "${PLATFORM_API_SECRET}"
    depends_on:
      postgres:
        condition: service_healthy
      mysql:
        condition: service_healthy
      redis:
        condition: service_healthy
      minio:
        condition: service_healthy
    volumes:
      - ./config/aitools/config.env:/opt/core/plugin/aitools/config.env
      - ./config/aitools/logs/:/opt/core/logs/
    networks:
      - astron-agent-network
    restart: always

  # Agent Service
  core-agent:
    image: core-agent:local
    build:
      context: ../../
      dockerfile: core/agent/Dockerfile
    container_name: astron-agent-core-agent
    environment:
      SERVICE_LOCATION: "${SERVICE_LOCATION:-hf}"
      SERVICE_HOST: "${SERVICE_HOST:-0.0.0.0}"
      SERVICE_PORT: "${CORE_AGENT_PORT:-17870}"
      SERVICE_WORKERS: "${SERVICE_WORKERS:-1}"
      SERVICE_RELOAD: "${SERVICE_RELOAD:-false}"
      SERVICE_WS_PING_INTERVAL: "${SERVICE_WS_PING_INTERVAL:-false}"
      SERVICE_WS_PING_TIMEOUT: "${SERVICE_WS_PING_TIMEOUT:-false}"
      REDIS_CLUSTER_ADDR: "${REDIS_CLUSTER_ADDR}"
      REDIS_ADDR: "${REDIS_ADDR:-redis:6379}"
      REDIS_PASSWORD: "${REDIS_PASSWORD}"
      REDIS_EXPIRE: "${REDIS_EXPIRE:-3600}"
      MYSQL_HOST: "${MYSQL_HOST:-mysql}"
      MYSQL_PORT: "${MYSQL_PORT:-3306}"
      MYSQL_USER: "${MYSQL_USER:-root}"
      MYSQL_PASSWORD: "${MYSQL_PASSWORD:-root123}"
      MYSQL_DB: "${AGENT_MYSQL_DB:-agent}"
      OTLP_ENDPOINT: "${OTLP_ENDPOINT:-127.0.0.1:4317}"
      OTLP_METRIC_TIMEOUT: "${OTLP_METRIC_TIMEOUT:-3000}"
      OTLP_METRIC_EXPORT_INTERVAL_MILLIS: "${OTLP_METRIC_EXPORT_INTERVAL_MILLIS:-3000}"
      OTLP_METRIC_EXPORT_TIMEOUT_MILLIS: "${OTLP_METRIC_EXPORT_TIMEOUT_MILLIS:-3000}"
      UPLOAD_NODE_TRACE: "${UPLOAD_NODE_TRACE:-true}"
      UPLOAD_METRICS: "${UPLOAD_METRICS:-true}"
      OTLP_TRACE_TIMEOUT: "${OTLP_TRACE_TIMEOUT:-3000}"
      OTLP_TRACE_MAX_QUEUE_SIZE: "${OTLP_TRACE_MAX_QUEUE_SIZE:-2048}"
      OTLP_TRACE_SCHEDULE_DELAY_MILLIS: "${OTLP_TRACE_SCHEDULE_DELAY_MILLIS:-3000}"
      OTLP_TRACE_MAX_EXPORT_BATCH_SIZE: "${OTLP_TRACE_MAX_EXPORT_BATCH_SIZE:-2048}"
      OTLP_TRACE_EXPORT_TIMEOUT_MILLIS: "${OTLP_TRACE_EXPORT_TIMEOUT_MILLIS:-3000}"
      KAFKA_ENABLE: "${KAFKA_ENABLE:-0}"
      KAFKA_SERVERS: "${KAFKA_SERVERS:-kafka:29092}"
      KAFKA_TIMEOUT: "${KAFKA_TIMEOUT:-60}"
      KAFKA_TOPIC: "${AGENT_KAFKA_TOPIC:-spark-agent-builder}"
      GET_LINK_URL: "${GET_LINK_URL:-http://core-link:18888/api/v1/tools}"
      VERSIONS_LINK_URL: "${VERSIONS_LINK_URL:-http://core-link:18888/api/v1/tools/versions}"
      RUN_LINK_URL: "${RUN_LINK_URL:-http://core-link:18888/api/v1/tools/http_run}"
      GET_WORKFLOWS_URL: "${GET_WORKFLOWS_URL:-http://core-workflow:7880/sparkflow/v1/protocol/get}"
      WORKFLOW_SSE_BASE_URL: "${WORKFLOW_SSE_BASE_URL:-http://core-workflow:7880/workflow/v1}"
      # CHUNK_QUERY_URL: ""  # core-knowledge service removed
      LIST_MCP_PLUGIN_URL: "${LIST_MCP_PLUGIN_URL:-http://core-link:18888/api/v1/mcp/tool_list}"
      RUN_MCP_PLUGIN_URL: "${RUN_MCP_PLUGIN_URL:-http://core-link:18888/api/v1/mcp/call_tool}"
      # APP_AUTH_HOST: ""  # core-tenant service removed
      APP_AUTH_PROT: "${APP_AUTH_PROT:-http}"
      APP_AUTH_API_KEY: "${APP_AUTH_API_KEY:-YOUR_APP_AUTH_API_KEY}"
      APP_AUTH_SECRET: "${APP_AUTH_SECRET:-YOUR_APP_AUTH_SECRET}"
    depends_on:
      postgres:
        condition: service_healthy
      mysql:
        condition: service_healthy
      redis:
        condition: service_healthy
      minio:
        condition: service_healthy
    volumes:
      - ./config/agent/config.env:/opt/core/agent/config.env
    networks:
      - astron-agent-network
    restart: always

  # Workflow Service
  # Workflow Service - 支持 Python/Java 双版本切换
  # 通过环境变量 WORKFLOW_VERSION 控制: python (默认) 或 java
  core-workflow:
    image: core-workflow:local
    container_name: astron-agent-core-workflow
    build:
      context: ../../
      dockerfile: core/workflow/Dockerfile
    environment:
      RUNTIME_ENV: "${RUNTIME_ENV:-dev}"
      SERVICE_PORT: "${CORE_WORKFLOW_PORT:-7880}"
      MYSQL_HOST: "${MYSQL_HOST:-mysql}"
      MYSQL_PORT: "${MYSQL_PORT:-3306}"
      MYSQL_USER: "${MYSQL_USER:-root}"
      MYSQL_PASSWORD: "${MYSQL_PASSWORD:-root123}"
      MYSQL_DB: "${WORKFLOW_MYSQL_DB:-workflow}"
      REDIS_CLUSTER_ADDR: "${REDIS_CLUSTER_ADDR}"
      REDIS_ADDR: "${REDIS_ADDR:-redis:6379}"
      REDIS_PASSWORD: "${REDIS_PASSWORD}"
      REDIS_EXPIRE: "${REDIS_EXPIRE:-3600}"
      OTLP_ENDPOINT: "${OTLP_ENDPOINT:-127.0.0.1:4317}"
      OTLP_ENABLE: "${OTLP_ENABLE:-0}"
      OTLP_METRIC_EXPORT_INTERVAL_MILLIS: "${OTLP_METRIC_EXPORT_INTERVAL_MILLIS:-3000}"
      OTLP_METRIC_EXPORT_TIMEOUT_MILLIS: "${OTLP_METRIC_EXPORT_TIMEOUT_MILLIS:-3000}"
      OTLP_METRIC_TIMEOUT: "${OTLP_METRIC_TIMEOUT:-3000}"
      OTLP_TRACE_TIMEOUT: "${OTLP_TRACE_TIMEOUT:-3000}"
      OTLP_TRACE_MAX_QUEUE_SIZE: "${OTLP_TRACE_MAX_QUEUE_SIZE:-2048}"
      OTLP_TRACE_SCHEDULE_DELAY_MILLIS: "${OTLP_TRACE_SCHEDULE_DELAY_MILLIS:-3000}"
      OTLP_TRACE_MAX_EXPORT_BATCH_SIZE: "${OTLP_TRACE_MAX_EXPORT_BATCH_SIZE:-500}"
      OTLP_TRACE_EXPORT_TIMEOUT_MILLIS: "${OTLP_TRACE_EXPORT_TIMEOUT_MILLIS:-3000}"
      OSS_TYPE: "${OSS_TYPE:-s3}"
      OSS_ENDPOINT: "${OSS_ENDPOINT:-http://minio:9000}"
      OSS_ACCESS_KEY_ID: "${OSS_ACCESS_KEY_ID:-minioadmin}"
      OSS_ACCESS_KEY_SECRET: "${OSS_ACCESS_KEY_SECRET:-minioadmin123}"
      OSS_BUCKET_NAME: "${OSS_BUCKET_NAME}"
      OSS_DOWNLOAD_HOST: "${OSS_REMOTE_ENDPOINT}"
      OSS_TTL: "${OSS_TTL:-157788000}"
      KAFKA_ENABLE: "${KAFKA_ENABLE:-0}"
      KAFKA_SERVERS: "${KAFKA_SERVERS:-kafka:29092}"
      KAFKA_TIMEOUT: "${KAFKA_TIMEOUT:-60}"
      KAFKA_TOPIC: "${WORKFLOW_KAFKA_TOPIC:-spark-agent-builder}"
      # KNOWLEDGE_BASE_URL: ""  # core-knowledge service removed
      # KNOWLEDGE_PRO_BASE_URL: ""  # core-knowledge service removed
      PLUGIN_BASE_URL: "${PLUGIN_BASE_URL:-http://core-link:${CORE_LINK_PORT}}"
      WORKFLOW_BASE_URL: "${WORKFLOW_BASE_URL:-http://core-workflow:${CORE_WORKFLOW_PORT}}"
      # APP_MANAGE_PLAT_BASE_URL: ""  # core-tenant service removed
      AGENT_BASE_URL: "${AGENT_BASE_URL:-http://core-agent:${CORE_AGENT_PORT}}"
      # PGSQL_BASE_URL: ""  # core-database service removed
      # RPA_BASE_URL: ""  # core-rpa service removed
      # Java Workflow 专用环境变量
      SERVER_PORT: "${CORE_WORKFLOW_PORT:-7880}"
      SPRING_APPLICATION_NAME: "core-workflow"
      MODEL_SERVICE_URL: "${MODEL_SERVICE_URL:-http://console-hub:8080}"
      AITOOLS_URL: "${AITOOLS_URL:-http://core-aitools:18668}"
      JAVA_OPTS: "${JAVA_OPTS:--XX:+UseContainerSupport -XX:MaxRAMPercentage=75.0}"
    depends_on:
      postgres:
        condition: service_healthy
      mysql:
        condition: service_healthy
      redis:
        condition: service_healthy
      minio:
        condition: service_healthy
    volumes:
      - ./config/workflow/config.env:/opt/core/workflow/config.env
      - ./config/workflow/logs/:/opt/core/logs
      - ./config/workflow-java/logs/:/app/logs  # Java workflow logs
    networks:
      - astron-agent-network
    restart: always

  # ============================================================================
  # astron-agent Console Services
  # ============================================================================

  # Nginx Reverse Proxy
  nginx:
    image: nginx:1.25-alpine
    container_name: astron-agent-nginx
    ports:
      - "${EXPOSE_NGINX_PORT:-80}:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - nginx_logs:/var/log/nginx
    depends_on:
      - console-hub
    networks:
      - astron-agent-network
    restart: always
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/nginx-health"]
      interval: ${HEALTH_CHECK_INTERVAL:-30s}
      timeout: ${HEALTH_CHECK_TIMEOUT:-10s}
      retries: ${HEALTH_CHECK_RETRIES:-60}

  # Console Frontend - REMOVED (run locally with npm run dev)
  # To start frontend locally:
  #   cd console/frontend
  #   npm run dev
  # Frontend will be available at http://localhost:3000

#   Console Hub Service
  console-hub:
    image: console-hub:local
    build:
      context: ../../
      dockerfile: console/backend/hub/Dockerfile
    container_name: astron-agent-console-hub
    # Map container's localhost to host machine, to access MinIO and other services from both inside and outside the container
    extra_hosts:  # 临时注释掉，避免连接 Redis 时指向宿主机
       - "localhost:host-gateway"
    environment:
      CONSOLE_CASDOOR_URL: "${CONSOLE_CASDOOR_URL:-}"
      CONSOLE_CASDOOR_ID: "${CONSOLE_CASDOOR_ID:-}"
      CONSOLE_CASDOOR_APP: "${CONSOLE_CASDOOR_APP:-}"
      CONSOLE_CASDOOR_ORG: "${CONSOLE_CASDOOR_ORG:-}"
      CONSOLE_DOMAIN: "${CONSOLE_DOMAIN:-https://your.deployment.domain}"
      MYSQL_URL: "${MYSQL_URL:-jdbc:mysql://mysql:3306/astron_console}"
      MYSQL_USER: "${MYSQL_USER:-root}"
      MYSQL_PASSWORD: "${MYSQL_PASSWORD:-root123}"
      REDIS_HOST: "${REDIS_HOST:-redis}"
      REDIS_PORT: "${REDIS_PORT:-6379}"
      REDIS_DATABASE_CONSOLE: "${REDIS_DATABASE_CONSOLE:-0}"
      OSS_ENDPOINT: "${OSS_ENDPOINT:-http://minio:9000}"
      OSS_REMOTE_ENDPOINT: "${OSS_REMOTE_ENDPOINT:-http://minio:9000}"
      OSS_ACCESS_KEY_ID: "${OSS_ACCESS_KEY_ID:-minioadmin}"
      OSS_ACCESS_KEY_SECRET: "${OSS_ACCESS_KEY_SECRET:-minioadmin123}"
      OSS_BUCKET_CONSOLE: "${OSS_BUCKET_CONSOLE:-console}"
      OSS_PRESIGN_EXPIRY_SECONDS_CONSOLE: "${OSS_PRESIGN_EXPIRY_SECONDS_CONSOLE:-600}"
      OAUTH2_ISSUER_URI: "${OAUTH2_ISSUER_URI:-http://auth-server:8000}"
      OAUTH2_JWK_SET_URI: "${OAUTH2_JWK_SET_URI:-http://auth-server:8000/.well-known/jwks}"
      OAUTH2_AUDIENCE: "${OAUTH2_AUDIENCE:-your-oauth2-client-id}"
      PLATFORM_APP_ID: "${PLATFORM_APP_ID:-your-app-id}"
      PLATFORM_API_KEY: "${PLATFORM_API_KEY:-your-api-key}"
      PLATFORM_API_SECRET: "${PLATFORM_API_SECRET:-your-api-secret}"
      SPARK_APP_ID: "${SPARK_APP_ID:-your-spark-app-id}"
      SPARK_API_KEY: "${SPARK_API_KEY:-your-spark-api-key}"
      SPARK_API_SECRET: "${SPARK_API_SECRET:-your-spark-api-secret}"
      SPARK_API_PASSWORD: "${SPARK_API_PASSWORD:-your-spark-api-password}"
      SPARK_RTASR_KEY: "${SPARK_RTASR_KEY:-your-spark-rtasr-key}"
      SPARK_RTASR_APPID: "${SPARK_RTASR_APPID:-your-spark-rtasr-appid}"
      SPARK_IMAGE_APP_ID: "${SPARK_IMAGE_APP_ID:-your-image-appid}"
      SPARK_IMAGE_API_KEY: "${SPARK_IMAGE_API_KEY:-your-image-api-key}"
      SPARK_IMAGE_API_SECRET: "${SPARK_IMAGE_API_SECRET:-your-image-api-secret}"
      WECHAT_COMPONENT_APPID: "${WECHAT_COMPONENT_APPID:-your-wechat-component-appid}"
      WECHAT_COMPONENT_SECRET: "${WECHAT_COMPONENT_SECRET:-your-wechat-component-secret}"
      WECHAT_TOKEN: "${WECHAT_TOKEN:-your-wechat-token}"
      WECHAT_ENCODING_AES_KEY: "${WECHAT_ENCODING_AES_KEY:-your-wechat-encoding-aes-key}"
      WORKFLOW_CHAT_URL: "${WORKFLOW_CHAT_URL:-http://core-workflow-java:7881/api/v1/workflow/chat/stream}"
      WORKFLOW_DEBUG_URL: "${WORKFLOW_DEBUG_URL:-http://core-workflow-java:7881/api/v1/workflow/chat/stream}"
      WORKFLOW_RESUME_URL: "${WORKFLOW_RESUME_URL:-http://core-workflow-java:7881/api/v1/workflow/chat/resume}"
      COMMON_APPID: "${COMMON_APPID:-appid}"
      COMMON_APIKEY: "${COMMON_APIKEY:-apiKey}"
      COMMON_API_SECRET: "${COMMON_API_SECRET:-apiSecret}"
      TENANT_ID: "${TENANT_ID:-tenantId}"
      TENANT_KEY: "${TENANT_KEY:-tenantKey}"
      TENANT_SECRET: "${TENANT_SECRET:-tenantSecret}"
      ADMIN_UID: "${ADMIN_UID:-9999}"
      APP_URL: "${APP_URL:-}"
      KNOWLEDGE_URL: "${KNOWLEDGE_URL:-}"
      TOOL_URL: "${TOOL_URL:-}"
      TOOL_RPA_URL: "${TOOL_RPA_URL:-}"
      WORKFLOW_URL: "${WORKFLOW_URL:-}"
      SPARK_DB_URL: "${SPARK_DB_URL:-}"
      LOCAL_MODEL_URL: "${LOCAL_MODEL_URL:-}"
      RPA_URL: "${RPA_URL:-}"
      MAAS_APP_ID: "${MAAS_APP_ID:-your-maas-app-id}"
      MAAS_API_KEY: "${MAAS_API_KEY:-your-maas-api-key}"
      MAAS_API_SECRET: "${MAAS_API_SECRET:-your-maas-api-secret}"
      MAAS_CONSUMER_ID: "${MAAS_CONSUMER_ID:-your-maas-consumer-id}"
      MAAS_CONSUMER_SECRET: "${MAAS_CONSUMER_SECRET:-your-maas-consumer-secret}"
      MAAS_CONSUMER_KEY: "${MAAS_CONSUMER_KEY:-your-maas-consumer-key}"
      MAAS_WORKFLOW_VERSION: "${MAAS_WORKFLOW_VERSION:-}"
      MAAS_SYNCHRONIZE_WORK_FLOW: "${MAAS_SYNCHRONIZE_WORK_FLOW:-}"
      MAAS_PUBLISH: "${MAAS_PUBLISH:-}"
      MAAS_CLONE_WORK_FLOW: "${MAAS_CLONE_WORK_FLOW:-}"
      MAAS_GET_INPUTS: "${MAAS_GET_INPUTS:-}"
      MAAS_CAN_PUBLISH_URL: "${MAAS_CAN_PUBLISH_URL:-}"
      MAAS_PUBLISH_API: "${MAAS_PUBLISH_API:-}"
      MAAS_AUTH_API: "${MAAS_AUTH_API:-}"
      MAAS_MCP_REGISTER: "${MAAS_MCP_REGISTER:-}"
      MAAS_WORKFLOW_CONFIG: "${MAAS_WORKFLOW_CONFIG:-}"
      BOT_API_CBM_BASE_URL: "${BOT_API_CBM_BASE_URL:-}"
      BOT_API_MAAS_BASE_URL: "${BOT_API_MAAS_BASE_URL:-}"
      TENANT_CREATE_APP: "${TENANT_CREATE_APP:-}"
      TENANT_GET_APP_DETAIL: "${TENANT_GET_APP_DETAIL:-}"
      
    expose:
      - "8080"
    depends_on:
      postgres:
        condition: service_healthy
      mysql:
        condition: service_healthy
      redis:
        condition: service_healthy
      minio:
        condition: service_healthy
    networks:
      - astron-agent-network
    restart: always

# ============================================================================
# Network Configuration
# ============================================================================
networks:
  astron-agent-network:
    driver: bridge

# ============================================================================
# Volume Configuration
# ============================================================================
volumes:
  postgres_data:
    driver: local
  mysql_data:
    driver: local
  redis_data:
    driver: local
  minio_data:
    driver: local
  nginx_logs:
    driver: local
